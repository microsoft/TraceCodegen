description: program generation for apps; by iterative stmt generation

env_defaults:
  JOB_GPUS: 16

environment:
  registry: grail.azurecr.io
  username: grail
  image: trace-codegen-pl:latest
  setup:
    - pip install -r requirements.txt
    - python -m nltk.downloader punkt

code:
  local_dir: $CONFIG_DIR/..

storage:
  data:
    storage_account_name: wuphillyblob 
    container_name: trace-codegen-data
    local_dir: /mnt/trace-codegen-data

data:
  local_dir: data/apps
  remote_dir: data/apps
  storage_id: data

jobs:
  - name: train-full-parameterized_gpu$JOB_GPUS
    sku: 32G$JOB_GPUS@westus2,westus3,redmond,eastus
    # sku: G$JOB_GPUS
    # aml_mpirun:
    #   communicator: OpenMpi
    #   process_count_per_node: 1
    command:
      #- export TRACE_CODEGEN_DEBUG=1
      - bash amulet/apps-program-pred.sh \
          --trainer.gpus $JOB_GPUS
